{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zlitni%20Houssem/Desktop/New%20folder%20%2869%29/bed-sofa/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport fs from \"fs/promises\";\r\nimport path from \"path\";\r\nimport { Product } from \"@/lib/types\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nconst DATA_FILE_PATH = path.join(process.cwd(), \"data\", \"products.json\");\r\nconst UPLOAD_DIR = path.join(process.cwd(), \"public\", \"uploads\");\r\n\r\n// Ensure upload directory exists\r\nasync function ensureUploadDir() {\r\n    try {\r\n        await fs.access(UPLOAD_DIR);\r\n    } catch {\r\n        await fs.mkdir(UPLOAD_DIR, { recursive: true });\r\n    }\r\n}\r\n\r\nexport async function getProducts(): Promise<Product[]> {\r\n    try {\r\n        const data = await fs.readFile(DATA_FILE_PATH, \"utf-8\");\r\n        return JSON.parse(data);\r\n    } catch (error) {\r\n        console.error(\"Error reading products:\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getProduct(id: string): Promise<Product | undefined> {\r\n    const products = await getProducts();\r\n    return products.find((p) => p.id === id);\r\n}\r\n\r\nexport async function saveProduct(product: Product) {\r\n    try {\r\n        const products = await getProducts();\r\n        const existingIndex = products.findIndex((p) => p.id === product.id);\r\n\r\n        if (existingIndex >= 0) {\r\n            products[existingIndex] = product;\r\n        } else {\r\n            products.push(product);\r\n        }\r\n\r\n        await fs.writeFile(DATA_FILE_PATH, JSON.stringify(products, null, 2), \"utf-8\");\r\n        revalidatePath(\"/admin\");\r\n        revalidatePath(`/product/${product.id}`);\r\n        revalidatePath(\"/\"); // If we list products on home\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Error saving product:\", error);\r\n        return { success: false, error: \"Failed to save product\" };\r\n    }\r\n}\r\n\r\nexport async function uploadImage(formData: FormData) {\r\n    try {\r\n        await ensureUploadDir();\r\n        const file = formData.get(\"file\") as File;\r\n        if (!file) {\r\n            return { success: false, error: \"No file uploaded\" };\r\n        }\r\n\r\n        const buffer = Buffer.from(await file.arrayBuffer());\r\n        // Sanitize filename\r\n        const filename = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\");\r\n        const uniqueFilename = `${Date.now()}-${filename}`;\r\n        const filePath = path.join(UPLOAD_DIR, uniqueFilename);\r\n\r\n        await fs.writeFile(filePath, buffer);\r\n        return { success: true, url: `/uploads/${uniqueFilename}` };\r\n    } catch (error) {\r\n        console.error(\"Error uploading image:\", error);\r\n        return { success: false, error: \"Failed to upload image\" };\r\n    }\r\n}\r\n\r\nexport async function deleteProduct(id: string) {\r\n    try {\r\n        const products = await getProducts();\r\n        const filteredProducts = products.filter((p) => p.id !== id);\r\n\r\n        await fs.writeFile(DATA_FILE_PATH, JSON.stringify(filteredProducts, null, 2), \"utf-8\");\r\n        revalidatePath(\"/admin\");\r\n        revalidatePath(\"/\");\r\n        revalidatePath(\"/collection\");\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Error deleting product:\", error);\r\n        return { success: false, error: \"Failed to delete product\" };\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zlitni%20Houssem/Desktop/New%20folder%20%2869%29/bed-sofa/.next-internal/server/app/product/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getProducts as '0096fd0b8b965d7a17ecf62e6d62baf3ebbf223f8c'} from 'ACTIONS_MODULE0'\nexport {uploadImage as '4014945abcddb4ff7536839f7faba39d2953e2408e'} from 'ACTIONS_MODULE0'\nexport {deleteProduct as '4027cd32873fdadeed4824268d93ab39a663c01b9e'} from 'ACTIONS_MODULE0'\nexport {getProduct as '409e4f3d6b358708aa81c19afb3ac1e97fcf6130a8'} from 'ACTIONS_MODULE0'\nexport {saveProduct as '40ec3378f8f80dda749d4edab5ab4d0ca35fac02f7'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}